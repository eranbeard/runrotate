<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Edit Profile - RunRotate</title>
    <link rel="stylesheet" href="../../assets/css/styles.css">
    <link rel="stylesheet" href="../../assets/css/edit-profile.css">
    <link rel="stylesheet" href="../../assets/css/section-styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        .text-2xs {
            font-size: 0.6875rem; /* 11px */
            line-height: 0.875rem; /* 14px */
        }
        
        /* Test styles */
        .test-banner {
            background-color: #FFFAF0 !important;
            border-left: 4px solid #FFA500 !important;
            padding: 16px !important;
            margin-bottom: 24px !important;
            display: flex !important;
            align-items: center !important;
            justify-content: space-between !important;
        }
        .test-banner p {
            color: #5F370E !important;
            margin: 0 !important;
        }
        .test-btn {
            background-color: #FC4C02 !important;
            color: white !important;
            border: none !important;
            border-radius: 6px !important;
            padding: 8px 16px !important;
            font-weight: 600 !important;
            cursor: pointer !important;
        }
    </style>
</head>
<body>
    <div class="container">
        <div style="margin-bottom: 1rem;">
            <a href="../logged-in-new-user-janesmith/index.html" style="display: inline-flex; align-items: center; color: #4a6fa5; text-decoration: none; font-size: 0.875rem; font-weight: 500;">
                <i class="fas fa-arrow-left" style="margin-right: 0.5rem;"></i>
                Return to dashboard
            </a>
        </div>
        <div class="profile-edit-container">
            <div class="profile-edit-header">
                <h1><i class="fas fa-edit mr-2"></i>Edit Your Profile</h1>
                <p class="subtitle">Add your bio, race history, and personal records to complete your profile.</p>
            </div>

            <form class="profile-edit-form">
                <!-- Strava Connection Banner -->
                <div style="background-color: #FFFAF0; border-left: 4px solid #FFA500; border-radius: 4px; padding: 16px; margin-bottom: 24px; display: flex; align-items: center; justify-content: space-between;">
                    <p style="margin: 0; color: #5F370E; font-size: 16px; line-height: 1.5;">
                        Connect RunRotate with your Strava profile to sync shoe mileage, running stats and recent running activities.
                    </p>
                    <a href="#" style="background-color: #FC4C02; color: white; text-decoration: none; border-radius: 6px; padding: 8px 16px; font-weight: 600; display: inline-flex; align-items: center; white-space: nowrap; margin-left: 16px;">
                        <i class="fab fa-strava" style="margin-right: 8px; color: white;"></i>
                        Connect Strava
                    </a>
                </div>

                <!-- Profile Photo -->
                <div class="form-section">
                    <h3 class="flex items-center">
                        <span class="step-number">1</span>
                        Profile Photo
                    </h3>
                    <div class="profile-photo-upload">
                        <div class="avatar-preview">
                            <div class="relative w-full h-full">
                                <img src="https://via.placeholder.com/150" alt="Profile" id="profile-photo-preview" class="w-full h-full object-cover">
                                <div class="absolute inset-0 flex items-center justify-center bg-black/30 rounded-full opacity-0 hover:opacity-100 transition-opacity">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-smile-plus">
                                        <path d="M22 11v1a10 10 0 1 1-9-10"/>
                                        <path d="M8 14s1.5 2 4 2 4-2 4-2"/>
                                        <line x1="9" x2="9.01" y1="9" y2="9"/>
                                        <line x1="15" x2="15.01" y1="9" y2="9"/>
                                        <path d="M16 5h6"/>
                                        <path d="M19 2v6"/>
                                    </svg>
                                </div>
                            </div>
                        </div>
                        <div class="upload-actions">
                            <button type="button" class="ghost-button" id="upload-photo">Upload Profile Photo</button>
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <h3 class="flex items-center">
                        <span class="step-number">2</span>
                        Your Details
                    </h3>
                    <div class="form-group">
                        <label for="first-name" class="form-label">First Name</label>
                        <input type="text" id="first-name" class="form-input" value="Jane" required>
                    </div>

                    <div class="form-group">
                        <label for="last-name" class="form-label">Last Name</label>
                        <input type="text" id="last-name" class="form-input" value="Smith" required>
                    </div>

                    <div class="form-group">
                        <label for="email" class="form-label">Email</label>
                        <input type="email" id="email" class="form-input" value="jane@example.com" required>
                    </div>

                    <div class="form-group">
                        <label for="location" class="form-label">Location</label>
                        <input type="text" id="location" class="form-input" placeholder="e.g., New York, USA" required>
                    </div>
                </div>



                <!-- Bio -->
                <div class="form-section">
                    <h3 class="flex items-center">
                        <span class="step-number">3</span>
                        Your Bio
                    </h3>
                    <div class="form-group full-width">
                        <textarea id="bio" class="form-textarea" rows="4" placeholder="e.g. Recreational runner based in Melbourne, mostly logging road miles with the occasional trail adventure. Training for my second half marathon."></textarea>
                    </div>
                </div>

                <!-- Average Weekly -->
                <div class="form-section">
                    <div class="mb-4">
                        <h3 class="flex items-center">
                            <span class="step-number">4</span>
                            Weekly Distance
                        </h3>
                        <p class="text-gray-600 text-sm ml-10 mt-1">How much do you run per week?</p>
                    </div>
                    <div class="flex items-center gap-3">
                        <input type="number" id="weekly-distance" class="form-input w-32" min="0" step="0.1" placeholder="0.0">
                        <div class="unit-toggle flex bg-gray-100 rounded-md p-0.5">
                            <button type="button" class="unit-option text-sm px-3 py-1 rounded-md" data-unit="km">KM</button>
                            <button type="button" class="unit-option text-sm px-3 py-1 rounded-md" data-unit="mi">Miles</button>
                        </div>
                    </div>
                </div>

                <!-- Running Badges -->
                <div class="form-section badges-section">
                    <h3 class="flex items-center">
                        <span class="step-number">5</span>
                        Select Your Badges
                    </h3>
                    <p class="section-description">What kind of runner are you? Select all that apply - these will be displayed on your profile.</p>
                    <div class="badges-grid">
                        <label class="badge-option">
                            <input type="checkbox" name="focus" value="road">
                            <span class="badge-label">Road Runner</span>
                        </label>
                        <label class="badge-option">
                            <input type="checkbox" name="focus" value="trail">
                            <span class="badge-label">Trail Runner</span>
                        </label>
                        <label class="badge-option">
                            <input type="checkbox" name="focus" value="ultra">
                            <span class="badge-label">Ultra Runner</span>
                        </label>
                        <label class="badge-option">
                            <input type="checkbox" name="focus" value="track">
                            <span class="badge-label">Track Runner</span>
                        </label>
                        <label class="badge-option">
                            <input type="checkbox" name="focus" value="marathon">
                            <span class="badge-label">Marathoner</span>
                        </label>
                        <label class="badge-option">
                            <input type="checkbox" name="focus" value="sprinter">
                            <span class="badge-label">Sprinter</span>
                        </label>
                        <label class="badge-option">
                            <input type="checkbox" name="focus" value="parkrun">
                            <span class="badge-label">Parkrunner</span>
                        </label>
                        <label class="badge-option">
                            <input type="checkbox" name="focus" value="commuter">
                            <span class="badge-label">Run Commuter</span>
                        </label>
                        <label class="badge-option">
                            <input type="checkbox" name="focus" value="beginner">
                            <span class="badge-label">Beginner</span>
                        </label>
                        <label class="badge-option">
                            <input type="checkbox" name="focus" value="weekend">
                            <span class="badge-label">Weekend Warrior</span>
                        </label>
                        <label class="badge-option">
                            <input type="checkbox" name="focus" value="social">
                            <span class="badge-label">Social Runner</span>
                        </label>
                        <label class="badge-option">
                            <input type="checkbox" name="focus" value="club">
                            <span class="badge-label">Club Runner</span>
                        </label>
                        <label class="badge-option">
                            <input type="checkbox" name="focus" value="triathlete">
                            <span class="badge-label">Triathlete</span>
                        </label>
                        <label class="badge-option">
                            <input type="checkbox" name="focus" value="comeback">
                            <span class="badge-label">Comeback Runner</span>
                        </label>
                        <label class="badge-option">
                            <input type="checkbox" name="focus" value="adventure">
                            <span class="badge-label">Adventure Runner</span>
                        </label>
                        <label class="badge-option">
                            <input type="checkbox" name="focus" value="everyday">
                            <span class="badge-label">Everyday Runner</span>
                        </label>
                        <label class="badge-option">
                            <input type="checkbox" name="focus" value="treadmill">
                            <span class="badge-label">Treadmill Warrior</span>
                        </label>
                        <label class="badge-option">
                            <input type="checkbox" name="focus" value="coach">
                            <span class="badge-label">Coach</span>
                        </label>
                        <label class="badge-option">
                            <input type="checkbox" name="focus" value="pacer">
                            <span class="badge-label">Pacer</span>
                        </label>
                    </div>
                </div>

                <!-- Personal Bests -->
                <div class="form-section personal-bests">
                    <div class="section-header">
                        <div>
                            <h3>Personal Bests <span class="text-2xs font-normal text-gray-500">(optional)</span></h3>
                            <p class="section-subtitle">Keep track of all your fastest times in one place.</p>
                        </div>
                        <button type="button" class="btn-text btn-toggle-pbs" aria-expanded="false" aria-label="Toggle personal bests">
                            <i class="fas fa-chevron-down"></i>
                        </button>
                    </div>
                    <div class="pbs-content" style="display: none;">
                    <div class="pr-list">
                        <div class="pr-item">
                            <select class="form-select pr-distance">
                                <option value="5k">5K</option>
                                <option value="10k">10K</option>
                                <option value="half">Half Marathon</option>
                                <option value="marathon">Marathon</option>
                                <option value="50k">50K</option>
                                <option value="100k">100K</option>
                                <option value="half-ironman">Half Ironman</option>
                                <option value="ironman">Ironman</option>
                                <option value="custom">Custom distance</option>
                            </select>
                            <div class="custom-distance-container" style="display: none;">
                                <input type="number" class="form-input custom-distance" placeholder="Distance" min="0" step="0.01">
                                <span class="unit-display">km</span>
                            </div>
                            <input type="date" class="form-input pr-date">
                            <input type="text" class="form-input pr-time" placeholder="HH:MM:SS">
                            <button type="button" class="btn-icon" title="Remove">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    </div>
                        <button type="button" class="btn-text" id="add-pr">
                            <i class="fas fa-plus"></i> Add Personal Best
                        </button>
                    </div>
                </div>

                <!-- Recent Events -->
                <div class="form-section recent-events">
                    <div class="section-header">
                        <div>
                            <h3>Running Events (Past & Future) <span class="text-2xs font-normal text-gray-500">(optional)</span></h3>
                            <p class="section-subtitle">Add any races you've done or ones you're planning to do.</p>
                        </div>
                        <button type="button" class="btn-text btn-toggle-events" aria-expanded="false" aria-label="Toggle events">
                            <i class="fas fa-chevron-down"></i>
                        </button>
                    </div>
                    <div class="events-content" style="display: none;">
                    <div class="event-list">
                        <div class="event-item">
                            <div class="event-grid">
                                <div class="form-group">
                                    <label>Event Name</label>
                                    <input type="text" class="form-input" placeholder="e.g., Boston Marathon">
                                </div>
                                <div class="form-group">
                                    <label>Location</label>
                                    <input type="text" class="form-input" placeholder="e.g., Boston, MA">
                                </div>
                                <div class="form-group">
                                    <label>Date (Past or Future)</label>
                                    <input type="date" class="form-input">
                                </div>
                                <div class="form-group">
                                    <label>Distance <span class="unit-display" data-km="km" data-mi="mi">(km)</span></label>
                                    <input type="number" class="form-input" min="0" step="0.1">
                                </div>
                                <div class="form-group">
                                    <label>Time</label>
                                    <input type="text" class="form-input" placeholder="HH:MM:SS">
                                </div>
                            </div>
                            <button type="button" class="btn-icon remove-event" title="Remove event">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    </div>
                        <button type="button" class="btn-text" id="add-event">
                            <i class="fas fa-plus"></i> Add Another Event
                        </button>
                    </div>
                </div>



                <!-- Form Actions -->
                <div style="margin-top: 2rem; padding-top: 1.5rem; border-top: 1px solid #e5e7eb;">
                    <div style="display: flex; gap: 1rem; width: 100%;">
                        <button type="button" class="btn-ghost" style="flex: 1; padding: 0.75rem 1.5rem; border-radius: 8px; font-weight: 500; font-size: 1rem; cursor: pointer; transition: all 0.2s ease; display: flex; align-items: center; justify-content: center; gap: 0.5rem; text-transform: none !important; letter-spacing: normal !important; background: transparent; border: 1px solid #e5e7eb; color: #1f2937;">
                            <i class="fas fa-save"></i> Save as Draft
                        </button>
                        <a href="../logged-in-new-user-janesmith/index.html" class="btn-primary" style="flex: 1; padding: 0.75rem 1.5rem; border-radius: 8px; font-weight: 500; font-size: 1rem; cursor: pointer; transition: all 0.2s ease; background: #000000; color: white; border: 1px solid #000000; display: flex; align-items: center; justify-content: center; gap: 0.5rem; text-decoration: none;" data-component-name="&lt;a /&gt;">
                            <i class="fas fa-check"></i> Save Profile
                        </a>
                    </div>
                    <div style="text-align: center; margin-top: 0.75rem;">
                        <a href="../logged-in-new-user-janesmith/index.html" style="font-size: 0.875rem; color: rgb(75, 85, 99); text-decoration: none;" onmouseover="this.style.color='#1f2937'; this.style.textDecoration='underline';" onmouseout="this.style.color='#4b5563'; this.style.textDecoration='none';" data-component-name="&lt;a /&gt;">
                            Return without saving
                        </a>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Unit conversion functions
        const convertKmToMi = (km) => (km * 0.621371).toFixed(1);
        const convertMiToKm = (mi) => (mi * 1.60934).toFixed(1);
        
        // Unit toggle functionality
        function updateDisplayedUnits(unit) {
            // Update unit display text
            document.querySelectorAll('.unit-display').forEach(el => {
                el.textContent = `(${unit === 'km' ? 'km' : 'mi'})`;
            });
            
            // Convert distance values in the weekly distance field
            const weeklyDistanceInput = document.getElementById('weekly-distance');
            if (weeklyDistanceInput && weeklyDistanceInput.value) {
                const currentValue = parseFloat(weeklyDistanceInput.value);
                if (!isNaN(currentValue)) {
                    if (unit === 'mi' && weeklyDistanceInput.dataset.unit === 'km') {
                        weeklyDistanceInput.value = convertKmToMi(currentValue);
                        weeklyDistanceInput.dataset.unit = 'mi';
                    } else if (unit === 'km' && weeklyDistanceInput.dataset.unit === 'mi') {
                        weeklyDistanceInput.value = convertMiToKm(currentValue);
                        weeklyDistanceInput.dataset.unit = 'km';
                    }
                }
            }
            
            // Convert distance values in the running events
            document.querySelectorAll('.event-item input[type="number"]').forEach(input => {
                if (input.value) {
                    const currentValue = parseFloat(input.value);
                    if (!isNaN(currentValue)) {
                        if (unit === 'mi' && input.dataset.unit === 'km') {
                            input.value = convertKmToMi(currentValue);
                            input.dataset.unit = 'mi';
                        } else if (unit === 'km' && input.dataset.unit === 'mi') {
                            input.value = convertMiToKm(currentValue);
                            input.dataset.unit = 'km';
                        }
                    }
                } else {
                    // Set initial unit
                    input.dataset.unit = unit;
                }
            });
            
            // Update active state of toggle buttons
            document.querySelectorAll('.unit-option').forEach(opt => {
                opt.classList.toggle('active', opt.dataset.unit === unit);
            });
        }
        
        // Unit toggle event listeners
        document.querySelectorAll('.unit-option').forEach(option => {
            option.addEventListener('click', function() {
                const unit = this.dataset.unit;
                updateDisplayedUnits(unit);
                // Store preference in localStorage
                localStorage.setItem('preferredUnit', unit);
            });
        });
        
        // Set default unit to metric
        const setDefaultUnit = () => {
            const savedUnit = localStorage.getItem('preferredUnit');
            updateDisplayedUnits(savedUnit || 'km');
        };
        
        // Toggle events section
        const toggleEventsButton = document.querySelector('.btn-toggle-events');
        const eventsContent = document.querySelector('.events-content');
        
        if (toggleEventsButton && eventsContent) {
            toggleEventsButton.addEventListener('click', () => {
                const isExpanded = toggleEventsButton.getAttribute('aria-expanded') === 'true';
                toggleEventsButton.setAttribute('aria-expanded', !isExpanded);
                eventsContent.style.display = isExpanded ? 'none' : 'block';
                
                // Rotate the icon
                const icon = toggleEventsButton.querySelector('i');
                if (icon) {
                    icon.style.transform = isExpanded ? 'rotate(0deg)' : 'rotate(180deg)';
                }
            });
        }
        
        // Toggle personal bests section
        const togglePbsButton = document.querySelector('.btn-toggle-pbs');
        const pbsContent = document.querySelector('.pbs-content');
        
        if (togglePbsButton && pbsContent) {
            togglePbsButton.addEventListener('click', () => {
                const isExpanded = togglePbsButton.getAttribute('aria-expanded') === 'true';
                togglePbsButton.setAttribute('aria-expanded', !isExpanded);
                pbsContent.style.display = isExpanded ? 'none' : 'block';
                
                // Rotate the icon
                const icon = togglePbsButton.querySelector('i');
                if (icon) {
                    icon.style.transform = isExpanded ? 'rotate(0deg)' : 'rotate(180deg)';
                }
            });
        }
        
        // Initialize units
        document.addEventListener('DOMContentLoaded', () => {
            setDefaultUnit();
            
            // Set initial unit for existing distance inputs
            const initialUnit = localStorage.getItem('preferredUnit') || 'km';
            document.querySelectorAll('input[type="number"]').forEach(input => {
                input.dataset.unit = initialUnit;
            });
        });

        // Add PR
        document.getElementById('add-pr').addEventListener('click', () => {
            const prList = document.querySelector('.pr-list');
            const newPr = document.createElement('div');
            newPr.className = 'pr-item';
            newPr.innerHTML = `
                <select class="form-select pr-distance">
                    <option value="5k">5K</option>
                    <option value="10k">10K</option>
                    <option value="half">Half Marathon</option>
                    <option value="marathon">Marathon</option>
                    <option value="50k">50K</option>
                    <option value="100k">100K</option>
                    <option value="half-ironman">Half Ironman</option>
                    <option value="ironman">Ironman</option>
                </select>
                <input type="date" class="form-input pr-date">
                <input type="text" class="form-input pr-time" placeholder="HH:MM:SS">
                <button type="button" class="btn-icon" title="Remove">
                    <i class="fas fa-times"></i>
                </button>
            `;
            prList.appendChild(newPr);
            
            // Add event listener to the new remove button
            newPr.querySelector('.btn-icon').addEventListener('click', () => {
                if (document.querySelectorAll('.pr-item').length > 1) {
                    newPr.remove();
                }
            });
        });

        // Add event
        document.getElementById('add-event').addEventListener('click', () => {
            const eventList = document.querySelector('.event-list');
            const newEvent = document.createElement('div');
            newEvent.className = 'event-item';
            newEvent.innerHTML = `
                <div class="event-grid">
                    <div class="form-group">
                        <label>Event Name</label>
                        <input type="text" class="form-input" placeholder="e.g., Boston Marathon">
                    </div>
                    <div class="form-group">
                        <label>Location</label>
                        <input type="text" class="form-input" placeholder="e.g., Boston, MA">
                    </div>
                    <div class="form-group">
                        <label>Date</label>
                        <input type="date" class="form-input">
                    </div>
                    <div class="form-group">
                        <label>Distance <span class="unit-display">(km)</span></label>
                        <input type="number" class="form-input" min="0" step="0.1">
                    </div>
                    <div class="form-group">
                        <label>Time</label>
                        <input type="text" class="form-input" placeholder="HH:MM:SS">
                    </div>
                </div>
                <button type="button" class="btn-icon remove-event" title="Remove event">
                    <i class="fas fa-times"></i>
                </button>
            `;
            eventList.appendChild(newEvent);
            
            // Add event listener to the remove button
            newEvent.querySelector('.remove-event').addEventListener('click', () => {
                newEvent.remove();
            });
        });

        // Remove event
        document.addEventListener('click', (e) => {
            if (e.target.closest('.remove-event') || e.target.classList.contains('remove-event')) {
                const eventItem = e.target.closest('.event-item');
                if (eventItem && document.querySelectorAll('.event-item').length > 1) {
                    eventItem.remove();
                }
            }
        });

        // Profile photo upload (simplified example)
        document.getElementById('upload-photo').addEventListener('click', () => {
            // In a real app, this would open a file picker
            console.log('Open file picker to upload photo');
        });

        document.getElementById('edit-photo').addEventListener('click', () => {
            // In a real app, this would open a file picker or photo editor
            console.log('Open photo editor');
        });

        // Connect to Strava
        document.getElementById('connect-strava').addEventListener('click', () => {
            // In a real app, this would initiate OAuth flow
            console.log('Connect to Strava');
        });
    </script>
    <script>
    // Handle custom distance selection
    document.addEventListener('DOMContentLoaded', function() {
        console.log('Script loaded');
        
        // Function to handle distance selection change
        function handleDistanceChange(selectElement) {
            console.log('Distance changed:', selectElement.value);
            const container = selectElement.closest('.pr-item').querySelector('.custom-distance-container');
            if (selectElement.value === 'custom') {
                container.style.display = 'flex';
                container.querySelector('.custom-distance').focus();
            } else {
                container.style.display = 'none';
            }
        }

        // Add event listener to existing distance select
        document.querySelectorAll('.pr-distance').forEach(select => {
            select.addEventListener('change', function() {
                handleDistanceChange(this);
            });
        });

        // Add new PR item
        const addPrBtn = document.getElementById('add-pr');
        const prList = document.querySelector('.pr-list');
        
        if (addPrBtn && prList) {
            addPrBtn.addEventListener('click', function() {
                const newPr = document.createElement('div');
                newPr.innerHTML = `
                    <div class="pr-item">
                        <select class="form-select pr-distance">
                            <option value="5k">5K</option>
                            <option value="10k">10K</option>
                            <option value="half">Half Marathon</option>
                            <option value="marathon">Marathon</option>
                            <option value="50k">50K</option>
                            <option value="100k">100K</option>
                            <option value="half-ironman">Half Ironman</option>
                            <option value="ironman">Ironman</option>
                            <option value="custom">Custom distance</option>
                        </select>
                        <div class="custom-distance-container" style="display: none;">
                            <input type="number" class="form-input custom-distance" placeholder="Distance" min="0" step="0.01">
                            <span class="unit-display">km</span>
                        </div>
                        <input type="text" class="form-input pr-time" placeholder="HH:MM:SS">
                        <button type="button" class="btn-icon remove-pr" title="Remove">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>`;
                
                prList.appendChild(newPr.firstElementChild);
                
                // Add event listener to the new distance select
                const newSelect = newPr.querySelector('.pr-distance');
                if (newSelect) {
                    newSelect.addEventListener('change', function() {
                        handleDistanceChange(this);
                    });
                }
                
                // Add event listener to the remove button
                const removeBtn = newPr.querySelector('.remove-pr');
                if (removeBtn) {
                    removeBtn.addEventListener('click', function() {
                        this.closest('.pr-item').remove();
                    });
                }
            });
        }
    });
    </script>
    <script src="edit-profile.js"></script>
    <script src="profile-completion.js"></script>
</body>
</html>
